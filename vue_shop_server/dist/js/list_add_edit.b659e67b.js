"use strict";(self["webpackChunkvue_project"]=self["webpackChunkvue_project"]||[]).push([[508],{89:function(e,t){t.Z=(e,t)=>{const a=e.__vccOpts||e;for(const[o,r]of t)a[o]=r;return a}},1247:function(e,t,a){a.r(t),a.d(t,{default:function(){return u}});var o=a(311);const r=["src"];function l(e,t,a,l,d,i){const n=(0,o.resolveComponent)("el-breadcrumb-item"),s=(0,o.resolveComponent)("el-breadcrumb"),c=(0,o.resolveComponent)("el-alert"),u=(0,o.resolveComponent)("el-step"),h=(0,o.resolveComponent)("el-steps"),p=(0,o.resolveComponent)("el-input"),m=(0,o.resolveComponent)("el-form-item"),g=(0,o.resolveComponent)("el-cascader"),_=(0,o.resolveComponent)("el-tab-pane"),V=(0,o.resolveComponent)("el-checkbox"),b=(0,o.resolveComponent)("el-checkbox-group"),C=(0,o.resolveComponent)("el-button"),v=(0,o.resolveComponent)("el-upload"),w=(0,o.resolveComponent)("quill-editor"),f=(0,o.resolveComponent)("el-tabs"),x=(0,o.resolveComponent)("el-form"),N=(0,o.resolveComponent)("el-card"),y=(0,o.resolveComponent)("el-dialog");return(0,o.openBlock)(),(0,o.createElementBlock)("div",null,[(0,o.createVNode)(s,{"separator-icon":d.ArrowRight},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(n,{to:{path:"/home/welcome"}},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("首页")])),_:1}),(0,o.createVNode)(n,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("商品管理")])),_:1}),(0,o.createVNode)(n,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("商品列表")])),_:1}),(0,o.createVNode)(n,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("添加商品")])),_:1})])),_:1},8,["separator-icon"]),(0,o.createVNode)(N,null,{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c,{title:"添加商品信息",type:"info",center:"","show-icon":"",closable:!1}),(0,o.createVNode)(h,{active:1*d.activeIndex,"finish-status":"success","align-center":""},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(u,{title:"基本信息"}),(0,o.createVNode)(u,{title:"商品参数"}),(0,o.createVNode)(u,{title:"商品属性"}),(0,o.createVNode)(u,{title:"商品图片"}),(0,o.createVNode)(u,{title:"商品内容"}),(0,o.createVNode)(u,{title:"完成"})])),_:1},8,["active"]),(0,o.createVNode)(x,{ref:"addFormRef",model:d.addForm,rules:d.addFormRules,"label-width":"100px","label-position":"top"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(f,{"tab-position":"left",modelValue:d.activeIndex,"onUpdate:modelValue":t[6]||(t[6]=e=>d.activeIndex=e),"before-leave":i.beforeTabChange,onTabChange:i.tabChanged},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(_,{label:"基本信息",name:"0"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(m,{label:"商品名称",prop:"goods_name"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(p,{modelValue:d.addForm.goods_name,"onUpdate:modelValue":t[0]||(t[0]=e=>d.addForm.goods_name=e),placeholder:"请输入商品名称"},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(m,{label:"商品价格",prop:"goods_price"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(p,{modelValue:d.addForm.goods_price,"onUpdate:modelValue":t[1]||(t[1]=e=>d.addForm.goods_price=e),type:"number",placeholder:"请输入商品价格"},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(m,{label:"商品重量",prop:"goods_weight"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(p,{modelValue:d.addForm.goods_weight,"onUpdate:modelValue":t[2]||(t[2]=e=>d.addForm.goods_weight=e),type:"number",placeholder:"请输入商品重量"},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(m,{label:"商品数量",prop:"goods_number"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(p,{modelValue:d.addForm.goods_number,"onUpdate:modelValue":t[3]||(t[3]=e=>d.addForm.goods_number=e),type:"number",placeholder:"请输入商品数量"},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(m,{label:"商品分类",prop:"goods_cat"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(g,{modelValue:d.addForm.goods_cat,"onUpdate:modelValue":t[4]||(t[4]=e=>d.addForm.goods_cat=e),options:d.cateList,props:d.cascadeProps,onChange:i.handleCascadeChange},null,8,["modelValue","options","props","onChange"])])),_:1})])),_:1}),(0,o.createVNode)(_,{label:"商品参数",name:"1"},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(d.manyTableData,(e=>((0,o.openBlock)(),(0,o.createBlock)(m,{key:e.attr_id,label:e.attr_name},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(b,{modelValue:e.attr_vals,"onUpdate:modelValue":t=>e.attr_vals=t},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(e.attr_vals,((e,t)=>((0,o.openBlock)(),(0,o.createBlock)(V,{key:t,label:e,border:""},null,8,["label"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["label"])))),128))])),_:1}),(0,o.createVNode)(_,{label:"商品属性",name:"2"},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(d.onlyTableData,(e=>((0,o.openBlock)(),(0,o.createBlock)(m,{key:e.attr_id,label:e.attr_name},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(p,{modelValue:e.attr_vals,"onUpdate:modelValue":t=>e.attr_vals=t},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["label"])))),128))])),_:1}),(0,o.createVNode)(_,{label:"商品图片",name:"3"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(m,null,{default:(0,o.withCtx)((()=>[(0,o.createVNode)(v,{action:d.uploadURL,"on-preview":i.handlePreview,"on-remove":i.handleRemove,"list-type":"picture",headers:d.headerObj,"on-success":i.handleSuccess},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(C,{type:"primary",size:"small"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("点击上传")])),_:1})])),_:1},8,["action","on-preview","on-remove","headers","on-success"])])),_:1})])),_:1}),(0,o.createVNode)(_,{label:"商品内容",name:"4"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(w,{content:d.addForm.goods_introduce,"onUpdate:content":t[5]||(t[5]=e=>d.addForm.goods_introduce=e),toolbar:"full","content-type":"html",onTextChange:e.textChange},null,8,["content","onTextChange"]),(0,o.createVNode)(C,{type:"primary",class:"btnAdd",onClick:i.addGood},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("添加商品")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["modelValue","before-leave","onTabChange"])])),_:1},8,["model","rules"])])),_:1}),(0,o.createVNode)(y,{modelValue:d.previewDialogVisible,"onUpdate:modelValue":t[7]||(t[7]=e=>d.previewDialogVisible=e),title:"图片预览",width:"80%"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("img",{src:d.previewPath,alt:"预览图片",class:"previewImg"},null,8,r)])),_:1},8,["modelValue"])])}a(1703),a(7658);var d=a(3010),i=a(2611),n={data(){const e=(e,t,a)=>{t<0&&a(new Error("输入的数字不能小于0")),a()};return{ArrowRight:d.ArrowRight,Search:d.Search,Edit:d.Edit,Delete:d.Delete,activeIndex:"0",addForm:{goods_name:"",goods_price:0,goods_weight:0,goods_number:0,goods_cat:[],pics:[],goods_introduce:"",attrs:[]},addFormRules:{goods_name:[{required:!0,message:"请输入商品名称",trigger:"blur"}],goods_price:[{required:!0,message:"请输入商品价格",trigger:"blur"},{validator:e,trigger:"blur"}],goods_weight:[{required:!0,message:"请输入商品重量",trigger:"blur"},{validator:e,trigger:"blur"}],goods_number:[{required:!0,message:"请输入商品数量",trigger:"blur"},{validator:e,trigger:"blur"}],goods_cat:[{required:!0,message:"请选择商品分类",trigger:"blur"}]},cateList:[],cascadeProps:{expandTrigger:"hover",label:"cat_name",value:"cat_id",children:"children"},manyTableData:[],onlyTableData:[],uploadURL:"http://127.0.0.1:8888/api/private/v1/upload",headerObj:{Authorization:window.sessionStorage.getItem("token")},previewPath:"",previewDialogVisible:!1}},created(){this.getCateList()},methods:{getCateList(){this.$api.httpGet("categories",{showOuter:"error",error:["获取商品分类信息失败！"]}).then((e=>{this.cateList=e.data}))},handleCascadeChange(){3!==this.addForm.goods_cat.length&&(this.addForm.goods_cat=[]),this.getManyTableData(),this.getOnlyTableData()},beforeTabChange(e,t){if("0"===t&&3!==this.addForm.goods_cat.length)return this.$message.error("请先选择商品分类"),!1},tabChanged(){"1"===this.activeIndex?this.getManyTableData():"2"===this.activeIndex&&this.getOnlyTableData()},getManyTableData(){this.$api.httpGet(`categories/${this.cateId}/attributes`,{showOuter:"error",error:["获取分类参数失败！"]},200,{params:{sel:"many"}}).then((e=>{e.data.forEach((e=>{e.attr_vals=0===e.attr_vals.length?[]:e.attr_vals.split(" ")})),this.manyTableData=e.data}))},getOnlyTableData(){this.$api.httpGet(`categories/${this.cateId}/attributes`,{showOuter:"error",error:["获取分类属性失败！"]},200,{params:{sel:"only"}}).then((e=>{this.onlyTableData=e.data}))},handlePreview(e){this.previewPath=e.response.data.url,this.previewDialogVisible=!0},handleRemove(e){const t=e.response.data.tmp_path,a=this.addForm.pics.findIndex((e=>e.pic===t));this.addForm.pics.splice(a,1)},handleSuccess(e){const t={pic:e.data.tmp_path};this.addForm.pics.push(t)},addGood(){this.$refs.addFormRef.validate((e=>{if(!e)return this.$message.error({message:"请填写必要的表单项",duration:1200});this.manyTableData.forEach((e=>{this.addForm.attrs.push({attr_id:e.attr_id,attr_value:e.attr_vals.join(" ")})})),this.onlyTableData.forEach((e=>{this.addForm.attrs.push({attr_id:e.attr_id,attr_value:e.attr_vals})}));const t=(0,i.cloneDeep)(this.addForm);t.goods_cat=t.goods_cat.join(","),this.$api.httpPost("goods",t,{error:["创建商品失败！"]},201).then((()=>{this.$router.push("goods")}))}))}},computed:{cateId(){return 3===this.addForm.goods_cat.length?this.addForm.goods_cat[2]:null}}},s=a(89);const c=(0,s.Z)(n,[["render",l],["__scopeId","data-v-9476cc96"]]);var u=c},7301:function(e,t,a){a.r(t),a.d(t,{default:function(){return c}});var o=a(311);const r=["src"];function l(e,t,a,l,d,i){const n=(0,o.resolveComponent)("el-breadcrumb-item"),s=(0,o.resolveComponent)("el-breadcrumb"),c=(0,o.resolveComponent)("el-alert"),u=(0,o.resolveComponent)("el-step"),h=(0,o.resolveComponent)("el-steps"),p=(0,o.resolveComponent)("el-input"),m=(0,o.resolveComponent)("el-form-item"),g=(0,o.resolveComponent)("el-cascader"),_=(0,o.resolveComponent)("el-tab-pane"),V=(0,o.resolveComponent)("el-checkbox"),b=(0,o.resolveComponent)("el-checkbox-group"),C=(0,o.resolveComponent)("el-button"),v=(0,o.resolveComponent)("el-upload"),w=(0,o.resolveComponent)("quill-editor"),f=(0,o.resolveComponent)("el-tabs"),x=(0,o.resolveComponent)("el-form"),N=(0,o.resolveComponent)("el-card"),y=(0,o.resolveComponent)("el-dialog");return(0,o.openBlock)(),(0,o.createElementBlock)("div",null,[(0,o.createVNode)(s,{"separator-icon":d.ArrowRight},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(n,{to:{path:"/home/welcome"}},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("首页")])),_:1}),(0,o.createVNode)(n,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("商品管理")])),_:1}),(0,o.createVNode)(n,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("商品列表")])),_:1}),(0,o.createVNode)(n,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("编辑商品")])),_:1})])),_:1},8,["separator-icon"]),(0,o.createVNode)(N,null,{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c,{title:"编辑商品信息",type:"info",center:"","show-icon":"",closable:!1}),(0,o.createVNode)(h,{active:1*d.activeIndex,"finish-status":"success","align-center":""},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(u,{title:"基本信息"}),(0,o.createVNode)(u,{title:"商品参数"}),(0,o.createVNode)(u,{title:"商品属性"}),(0,o.createVNode)(u,{title:"商品图片"}),(0,o.createVNode)(u,{title:"商品内容"}),(0,o.createVNode)(u,{title:"完成"})])),_:1},8,["active"]),(0,o.createVNode)(x,{ref:"editFormRef",model:d.editForm,rules:d.editFormRules,"label-width":"100px","label-position":"top"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(f,{"tab-position":"left",modelValue:d.activeIndex,"onUpdate:modelValue":t[6]||(t[6]=e=>d.activeIndex=e),"before-leave":e.beforeTabChange,onTabChange:i.tabChanged},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(_,{label:"基本信息",name:"0"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(m,{label:"商品名称",prop:"goods_name"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(p,{modelValue:d.editForm.goods_name,"onUpdate:modelValue":t[0]||(t[0]=e=>d.editForm.goods_name=e),placeholder:"请输入商品名称"},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(m,{label:"商品价格",prop:"goods_price"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(p,{modelValue:d.editForm.goods_price,"onUpdate:modelValue":t[1]||(t[1]=e=>d.editForm.goods_price=e),type:"number",placeholder:"请输入商品价格"},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(m,{label:"商品重量",prop:"goods_weight"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(p,{modelValue:d.editForm.goods_weight,"onUpdate:modelValue":t[2]||(t[2]=e=>d.editForm.goods_weight=e),type:"number",placeholder:"请输入商品重量"},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(m,{label:"商品数量",prop:"goods_number"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(p,{modelValue:d.editForm.goods_number,"onUpdate:modelValue":t[3]||(t[3]=e=>d.editForm.goods_number=e),type:"number",placeholder:"请输入商品数量"},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(m,{label:"商品分类"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(g,{modelValue:d.goods_cat,"onUpdate:modelValue":t[4]||(t[4]=e=>d.goods_cat=e),options:d.cateList,props:d.cascadeProps,disabled:""},null,8,["modelValue","options","props"])])),_:1})])),_:1}),(0,o.createVNode)(_,{label:"商品参数",name:"1"},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(d.manyTableData,(e=>((0,o.openBlock)(),(0,o.createBlock)(m,{key:e.attr_id,label:e.attr_name},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(b,{modelValue:e.attr_vals,"onUpdate:modelValue":t=>e.attr_vals=t},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(e.attr_vals,((e,t)=>((0,o.openBlock)(),(0,o.createBlock)(V,{key:t,label:e,border:""},null,8,["label"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["label"])))),128))])),_:1}),(0,o.createVNode)(_,{label:"商品属性",name:"2"},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(d.onlyTableData,(e=>((0,o.openBlock)(),(0,o.createBlock)(m,{key:e.attr_id,label:e.attr_name},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(p,{modelValue:e.attr_vals,"onUpdate:modelValue":t=>e.attr_vals=t},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["label"])))),128))])),_:1}),(0,o.createVNode)(_,{label:"商品图片",name:"3"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(m,null,{default:(0,o.withCtx)((()=>[(0,o.createVNode)(v,{"file-list":d.uploadFileList,action:d.uploadURL,"on-preview":i.handlePreview,"on-remove":i.handleRemove,"list-type":"picture",headers:d.headerObj,"on-success":i.handleSuccess},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(C,{type:"primary",size:"small"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("点击上传")])),_:1})])),_:1},8,["file-list","action","on-preview","on-remove","headers","on-success"])])),_:1})])),_:1}),(0,o.createVNode)(_,{label:"商品内容",name:"4"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(w,{content:d.editForm.goods_introduce,"onUpdate:content":t[5]||(t[5]=e=>d.editForm.goods_introduce=e),toolbar:"full","content-type":"html",onTextChange:e.textChange},null,8,["content","onTextChange"]),(0,o.createVNode)(C,{type:"primary",class:"btnEdit",onClick:i.editGood},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("编辑商品")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["modelValue","before-leave","onTabChange"])])),_:1},8,["model","rules"])])),_:1}),(0,o.createVNode)(y,{modelValue:d.previewDialogVisible,"onUpdate:modelValue":t[7]||(t[7]=e=>d.previewDialogVisible=e),title:"图片预览",width:"60%"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("img",{src:d.previewPath,alt:"预览图片",class:"previewImg"},null,8,r)])),_:1},8,["modelValue"])])}a(1703),a(7658);var d=a(3010),i={data(){const e=(e,t,a)=>{t<0&&a(new Error("输入的数字不能小于0")),a()};return{ArrowRight:d.ArrowRight,Search:d.Search,Edit:d.Edit,Delete:d.Delete,activeIndex:"0",editForm:{goods_name:"",goods_price:0,goods_number:0,goods_weight:0,goods_cat:"",pics:[],goods_introduce:"",attrs:[]},editFormRules:{goods_name:[{required:!0,message:"请输入商品名称",trigger:"blur"}],goods_price:[{required:!0,message:"请输入商品价格",trigger:"blur"},{validator:e,trigger:"blur"}],goods_weight:[{required:!0,message:"请输入商品重量",trigger:"blur"},{validator:e,trigger:"blur"}],goods_number:[{required:!0,message:"请输入商品数量",trigger:"blur"},{validator:e,trigger:"blur"}]},cateList:[],goods_cat:[],cascadeProps:{expandTrigger:"hover",label:"cat_name",value:"cat_id",children:"children"},manyTableData:[],onlyTableData:[],uploadURL:"http://127.0.0.1:8888/api/private/v1/upload",headerObj:{Authorization:window.sessionStorage.getItem("token")},uploadFileList:[],previewPath:"",previewDialogVisible:!1}},created(){window.sessionStorage.getItem("goodId")||(this.$error({message:"无效的商品信息！",duration:1200}),this.$router.push("/home/goods")),this.goodId=window.sessionStorage.getItem("goodId"),this.getGoodInfo(),this.getCateList()},methods:{getGoodInfo(){this.$api.httpGet(`goods/${this.goodId}`,{showOuter:"error",error:["商品信息获取失败！"]}).then((e=>{for(let t in this.editForm)this.editForm[t]=e.data[t];this.goods_cat=0===e.data.goods_cat.length?[]:e.data.goods_cat.split(","),this.goods_cat.forEach(((e,t)=>{this.goods_cat[t]=parseInt(e)})),e.data.attrs.forEach((e=>{"many"===e.attr_sel?this.manyTableData.push({attr_id:e.attr_id,attr_name:e.attr_name,attr_vals:0===e.attr_vals.length?[]:e.attr_vals.split(",")}):this.onlyTableData.push({attr_id:e.attr_id,attr_name:e.attr_name,attr_vals:e.attr_vals})})),e.data.pics.forEach((e=>{this.uploadFileList.push({name:"点击预览",url:e.pics_mid_url,pics_id:e.pics_id,saved:!0})}))}))},getCateList(){this.$api.httpGet("categories",{showOuter:"error",error:["获取商品分类信息失败！"]}).then((e=>{this.cateList=e.data}))},tabChanged(){"1"===this.activeIndex?this.getManyTableData():"2"===this.activeIndex&&this.getOnlyTableData()},getManyTableData(){this.$api.httpGet(`categories/${this.cateId}/attributes`,{showOuter:"error",error:["获取分类参数失败！"]},200,{params:{sel:"many"}}).then((e=>{e.data.forEach((e=>{e.attr_vals=0===e.attr_vals.length?[]:e.attr_vals.split(",")})),this.manyTableData=e.data}))},getOnlyTableData(){this.$api.httpGet(`categories/${this.cateId}/attributes`,{showOuter:"error",error:["获取分类属性失败！"]},200,{params:{sel:"only"}}).then((e=>{this.onlyTableData=e.data}))},handlePreview(e){e.saved?this.previewPath=e.url:this.previewPath=e.response.data.url,this.previewDialogVisible=!0},handleRemove(e){if(e.saved){const t=this.editForm.pics.findIndex((t=>t.pics_id===e.pics_id));this.editForm.pics.splice(t,1)}else{const t=e.response.data.tmp_path,a=this.editForm.pics.findIndex((e=>e.pic===t));this.editForm.pics.splice(a,1)}},handleSuccess(e){const t={pic:e.data.tmp_path};this.editForm.pics.push(t)},editGood(){this.$refs.editFormRef.validate((e=>{if(!e)return this.$message.error({message:"请填写必要的表单项",duration:1200});this.editForm.attrs=[],this.manyTableData.forEach((e=>{this.editForm.attrs.push({attr_id:e.attr_id,attr_value:e.attr_vals.join(",")})})),this.onlyTableData.forEach((e=>{this.editForm.attrs.push({attr_id:e.attr_id,attr_value:e.attr_vals})})),this.editForm.pics.forEach(((e,t)=>{if(e.pics_id){const a=e.pics_mid,o=a.substring(23);this.editForm.pics[t]={pic:"tmp_uploads\\"+o}}})),this.$api.httpPut("goods/"+this.goodId,this.editForm,{showOuter:"error",success:["编辑商品成功！"],error:["编辑商品失败！"]},200).then((()=>{this.$router.push("/home/goods")}))}))}},computed:{cateId(){return 3===this.goods_cat.length?this.goods_cat[2]:null}}},n=a(89);const s=(0,n.Z)(i,[["render",l],["__scopeId","data-v-03677c89"]]);var c=s},9188:function(e,t,a){a.r(t),a.d(t,{default:function(){return s}});var o=a(311);function r(e,t,a,r,l,d){const i=(0,o.resolveComponent)("el-breadcrumb-item"),n=(0,o.resolveComponent)("el-breadcrumb"),s=(0,o.resolveComponent)("el-button"),c=(0,o.resolveComponent)("el-input"),u=(0,o.resolveComponent)("el-col"),h=(0,o.resolveComponent)("el-row"),p=(0,o.resolveComponent)("el-table-column"),m=(0,o.resolveComponent)("el-table"),g=(0,o.resolveComponent)("el-pagination"),_=(0,o.resolveComponent)("el-card");return(0,o.openBlock)(),(0,o.createElementBlock)("div",null,[(0,o.createVNode)(n,{"separator-icon":l.ArrowRight},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(i,{to:{path:"/home/welcome"}},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("首页")])),_:1}),(0,o.createVNode)(i,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("商品管理")])),_:1}),(0,o.createVNode)(i,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("商品列表")])),_:1})])),_:1},8,["separator-icon"]),(0,o.createVNode)(_,null,{default:(0,o.withCtx)((()=>[(0,o.createVNode)(h,{gutter:"20"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(u,{span:8},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c,{modelValue:l.queryInfo.query,"onUpdate:modelValue":t[0]||(t[0]=e=>l.queryInfo.query=e),placeholder:"请输入内容",clearable:"",onClear:d.getGoodsList,onKeyup:(0,o.withKeys)(d.getGoodsList,["enter"])},{append:(0,o.withCtx)((()=>[(0,o.createVNode)(s,{icon:l.Search,onClick:d.getGoodsList},null,8,["icon","onClick"])])),_:1},8,["modelValue","onClear","onKeyup"])])),_:1}),(0,o.createVNode)(u,{span:4},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(s,{type:"primary",onClick:d.goAddPage},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("添加商品")])),_:1},8,["onClick"])])),_:1})])),_:1}),(0,o.createVNode)(m,{data:l.goodsList,border:"",stripe:"",style:{width:"100%"}},{default:(0,o.withCtx)((()=>[l.goodsList.length>0?((0,o.openBlock)(),(0,o.createBlock)(p,{key:0,type:"index",label:"#"})):(0,o.createCommentVNode)("",!0),(0,o.createVNode)(p,{prop:"goods_name",label:"商品名称","min-width":"666px"}),(0,o.createVNode)(p,{prop:"goods_price",label:"商品价格(元)",width:"97px"}),(0,o.createVNode)(p,{prop:"goods_weight",label:"商品重量",width:"74px"}),(0,o.createVNode)(p,{label:"创建时间","min-width":"150px"},{default:(0,o.withCtx)((e=>[(0,o.createTextVNode)((0,o.toDisplayString)(d.dateFormat(e.row.add_time)),1)])),_:1}),(0,o.createVNode)(p,{label:"操作",width:"165px"},{default:(0,o.withCtx)((e=>[(0,o.createVNode)(s,{type:"primary",icon:l.Edit,size:"small",onClick:t=>d.goEditPage(e.row.goods_id)},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("编辑")])),_:2},1032,["icon","onClick"]),(0,o.createVNode)(s,{type:"danger",icon:l.Delete,size:"small",onClick:t=>d.removeGood(e.row.goods_id)},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("删除")])),_:2},1032,["icon","onClick"])])),_:1})])),_:1},8,["data"]),(0,o.createVNode)(g,{"current-page":l.queryInfo.pagenum,"onUpdate:currentPage":t[1]||(t[1]=e=>l.queryInfo.pagenum=e),"page-size":l.queryInfo.pagesize,"onUpdate:pageSize":t[2]||(t[2]=e=>l.queryInfo.pagesize=e),total:l.total,"page-sizes":[10,20,50,100],small:"",background:"",layout:"total, sizes, prev, pager, next, jumper",onSizeChange:d.handleSizeChange,onCurrentChange:d.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])),_:1})])}a(7658);var l=a(3010),d={data(){return{ArrowRight:l.ArrowRight,Search:l.Search,Edit:l.Edit,Delete:l.Delete,goodsList:[],queryInfo:{query:"",pagesize:10,pagenum:1},total:0}},created(){this.getGoodsList()},methods:{getGoodsList(){this.$api.httpGet("goods",{showOuter:"error",error:["获取商品列表信息失败！"]},200,{params:this.queryInfo}).then((e=>{this.goodsList=e.data.goods,this.total=e.data.total}))},dateFormat(e){const t=new Date(e),a=t.getFullYear(),o=(t.getMonth()+1+"").padStart(2,"0"),r=(t.getDate()+"").padStart(2,"0"),l=(t.getHours()+"").padStart(2,"0"),d=(t.getMinutes()+"").padStart(2,"0"),i=(t.getSeconds()+"").padStart(2,"0");return`${a}-${o}-${r} ${l}:${d}:${i}`},handleSizeChange(e){this.queryInfo.pagesize=e,this.getGoodsList()},handleCurrentChange(e){this.queryInfo.pagenum=e,this.getGoodsList()},removeGood(e){this.$confirm("此操作将永久删除该商品，是否继续？","删除",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$api.httpDelete("goods/"+e,{error:["删除失败！"]}).then((()=>{this.getGoodsList()}))})).catch((()=>{this.$message({type:"info",message:"删除取消",duration:1200})}))},goAddPage(){this.$router.push("/home/goods/add")},goEditPage(e){window.sessionStorage.setItem("goodId",e),this.$router.push("/home/goods/edit")}}},i=a(89);const n=(0,i.Z)(d,[["render",r]]);var s=n}}]);
//# sourceMappingURL=list_add_edit.b659e67b.js.map