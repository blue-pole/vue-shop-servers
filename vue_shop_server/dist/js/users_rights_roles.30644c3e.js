(self["webpackChunkvue_project"]=self["webpackChunkvue_project"]||[]).push([[241],{6077:function(e,t,r){var o=r(6741),a=String,l=TypeError;e.exports=function(e){if("object"==typeof e||o(e))return e;throw l("Can't set "+a(e)+" as a prototype")}},3658:function(e,t,r){"use strict";var o=r(9781),a=r(3157),l=TypeError,i=Object.getOwnPropertyDescriptor,s=o&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}();e.exports=s?function(e,t){if(a(e)&&!i(e,"length").writable)throw l("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t}},648:function(e,t,r){var o=r(1694),a=r(6741),l=r(4326),i=r(5112),s=i("toStringTag"),d=Object,n="Arguments"==l(function(){return arguments}()),c=function(e,t){try{return e[t]}catch(r){}};e.exports=o?l:function(e){var t,r,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=c(t=d(e),s))?r:n?l(t):"Object"==(o=l(t))&&a(t.callee)?"Arguments":o}},7207:function(e){var t=TypeError,r=9007199254740991;e.exports=function(e){if(e>r)throw t("Maximum allowed index exceeded");return e}},1060:function(e,t,r){var o=r(1702),a=Error,l=o("".replace),i=function(e){return String(a(e).stack)}("zxcasd"),s=/\n\s*at [^:]*:[^\n]*/,d=s.test(i);e.exports=function(e,t){if(d&&"string"==typeof e&&!a.prepareStackTrace)while(t--)e=l(e,s,"");return e}},5392:function(e,t,r){var o=r(8880),a=r(1060),l=r(2914),i=Error.captureStackTrace;e.exports=function(e,t,r,s){l&&(i?i(e,t):o(e,"stack",a(r,s)))}},2914:function(e,t,r){var o=r(7293),a=r(9114);e.exports=!o((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",a(1,7)),7!==e.stack)}))},2104:function(e,t,r){var o=r(4374),a=Function.prototype,l=a.apply,i=a.call;e.exports="object"==typeof Reflect&&Reflect.apply||(o?i.bind(l):function(){return i.apply(l,arguments)})},5668:function(e,t,r){var o=r(1702),a=r(9662);e.exports=function(e,t,r){try{return o(a(Object.getOwnPropertyDescriptor(e,t)[r]))}catch(l){}}},9587:function(e,t,r){var o=r(6741),a=r(111),l=r(7674);e.exports=function(e,t,r){var i,s;return l&&o(i=t.constructor)&&i!==r&&a(s=i.prototype)&&s!==r.prototype&&l(e,s),e}},8340:function(e,t,r){var o=r(111),a=r(8880);e.exports=function(e,t){o(t)&&"cause"in t&&a(e,"cause",t.cause)}},3157:function(e,t,r){var o=r(4326);e.exports=Array.isArray||function(e){return"Array"==o(e)}},6277:function(e,t,r){var o=r(1340);e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:o(e)}},7674:function(e,t,r){var o=r(5668),a=r(9670),l=r(6077);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{e=o(Object.prototype,"__proto__","set"),e(r,[]),t=r instanceof Array}catch(i){}return function(r,o){return a(r),l(o),t?e(r,o):r.__proto__=o,r}}():void 0)},2626:function(e,t,r){var o=r(3070).f;e.exports=function(e,t,r){r in e||o(e,r,{configurable:!0,get:function(){return t[r]},set:function(e){t[r]=e}})}},1694:function(e,t,r){var o=r(5112),a=o("toStringTag"),l={};l[a]="z",e.exports="[object z]"===String(l)},1340:function(e,t,r){var o=r(648),a=String;e.exports=function(e){if("Symbol"===o(e))throw TypeError("Cannot convert a Symbol value to a string");return a(e)}},9191:function(e,t,r){"use strict";var o=r(5005),a=r(2597),l=r(8880),i=r(7976),s=r(7674),d=r(9920),n=r(2626),c=r(9587),u=r(6277),h=r(8340),m=r(5392),p=r(9781),g=r(1913);e.exports=function(e,t,r,f){var V="stackTraceLimit",C=f?2:1,w=e.split("."),x=w[w.length-1],N=o.apply(null,w);if(N){var b=N.prototype;if(!g&&a(b,"cause")&&delete b.cause,!r)return N;var y=o("Error"),v=t((function(e,t){var r=u(f?t:e,void 0),o=f?new N(e):new N;return void 0!==r&&l(o,"message",r),m(o,v,o.stack,2),this&&i(b,this)&&c(o,this,v),arguments.length>C&&h(o,arguments[C]),o}));if(v.prototype=b,"Error"!==x?s?s(v,y):d(v,y,{name:!0}):p&&V in N&&(n(v,N,V),n(v,N,"prepareStackTrace")),d(v,N),!g)try{b.name!==x&&l(b,"name",x),b.constructor=v}catch(R){}return v}}},7658:function(e,t,r){"use strict";var o=r(2109),a=r(7908),l=r(6244),i=r(3658),s=r(7207),d=r(7293),n=d((function(){return 4294967297!==[].push.call({length:4294967296},1)})),c=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}},u=n||!c();o({target:"Array",proto:!0,arity:1,forced:u},{push:function(e){var t=a(this),r=l(t),o=arguments.length;s(r+o);for(var d=0;d<o;d++)t[r]=arguments[d],r++;return i(t,r),r}})},1703:function(e,t,r){var o=r(2109),a=r(7854),l=r(2104),i=r(9191),s="WebAssembly",d=a[s],n=7!==Error("e",{cause:7}).cause,c=function(e,t){var r={};r[e]=i(e,t,n),o({global:!0,constructor:!0,arity:1,forced:n},r)},u=function(e,t){if(d&&d[e]){var r={};r[e]=i(s+"."+e,t,n),o({target:s,stat:!0,constructor:!0,arity:1,forced:n},r)}};c("Error",(function(e){return function(t){return l(e,this,arguments)}})),c("EvalError",(function(e){return function(t){return l(e,this,arguments)}})),c("RangeError",(function(e){return function(t){return l(e,this,arguments)}})),c("ReferenceError",(function(e){return function(t){return l(e,this,arguments)}})),c("SyntaxError",(function(e){return function(t){return l(e,this,arguments)}})),c("TypeError",(function(e){return function(t){return l(e,this,arguments)}})),c("URIError",(function(e){return function(t){return l(e,this,arguments)}})),u("CompileError",(function(e){return function(t){return l(e,this,arguments)}})),u("LinkError",(function(e){return function(t){return l(e,this,arguments)}})),u("RuntimeError",(function(e){return function(t){return l(e,this,arguments)}}))},4998:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return n}});var o=r(311);function a(e,t,r,a,l,i){const s=(0,o.resolveComponent)("el-breadcrumb-item"),d=(0,o.resolveComponent)("el-breadcrumb"),n=(0,o.resolveComponent)("el-table-column"),c=(0,o.resolveComponent)("el-tag"),u=(0,o.resolveComponent)("el-table"),h=(0,o.resolveComponent)("el-card");return(0,o.openBlock)(),(0,o.createElementBlock)("div",null,[(0,o.createVNode)(d,{"separator-icon":l.ArrowRight},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(s,{to:{path:"/home/welcome"}},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("首页")])),_:1}),(0,o.createVNode)(s,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("权限管理")])),_:1}),(0,o.createVNode)(s,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("权限列表")])),_:1})])),_:1},8,["separator-icon"]),(0,o.createVNode)(h,null,{default:(0,o.withCtx)((()=>[(0,o.createVNode)(u,{data:l.rightsList,border:"",stripe:""},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(n,{type:"index",label:"#"}),(0,o.createVNode)(n,{label:"权限名称",prop:"authName"}),(0,o.createVNode)(n,{label:"路径",prop:"path"}),(0,o.createVNode)(n,{label:"权限等级"},{default:(0,o.withCtx)((e=>["0"===e.row.level?((0,o.openBlock)(),(0,o.createBlock)(c,{key:0,type:"danger"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("一级")])),_:1})):(0,o.createCommentVNode)("",!0),"1"===e.row.level?((0,o.openBlock)(),(0,o.createBlock)(c,{key:1,type:"warning"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("二级")])),_:1})):(0,o.createCommentVNode)("",!0),"2"===e.row.level?((0,o.openBlock)(),(0,o.createBlock)(c,{key:2,type:"success"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("三级")])),_:1})):(0,o.createCommentVNode)("",!0)])),_:1})])),_:1},8,["data"])])),_:1})])}var l=r(3010),i={data(){return{ArrowRight:l.ArrowRight,rightsList:[]}},created(){this.getRightsList()},methods:{getRightsList(){this.$api.httpGet("rights/list",{showOuter:"error",error:["获取权限列表失败！"]}).then((e=>{this.rightsList=e.data}))}}},s=r(89);const d=(0,s.Z)(i,[["render",a]]);var n=d},1370:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return h}});var o=r(311);const a={class:"dialog-footer"},l={class:"dialog-footer"},i={class:"dialog-footer"};function s(e,t,r,s,d,n){const c=(0,o.resolveComponent)("el-breadcrumb-item"),u=(0,o.resolveComponent)("el-breadcrumb"),h=(0,o.resolveComponent)("el-button"),m=(0,o.resolveComponent)("el-col"),p=(0,o.resolveComponent)("el-row"),g=(0,o.resolveComponent)("el-tag"),f=(0,o.resolveComponent)("CaretRight"),V=(0,o.resolveComponent)("el-icon"),C=(0,o.resolveComponent)("el-table-column"),w=(0,o.resolveComponent)("el-table"),x=(0,o.resolveComponent)("el-card"),N=(0,o.resolveComponent)("el-input"),b=(0,o.resolveComponent)("el-form-item"),y=(0,o.resolveComponent)("el-form"),v=(0,o.resolveComponent)("el-dialog"),R=(0,o.resolveComponent)("el-tree");return(0,o.openBlock)(),(0,o.createElementBlock)("div",null,[(0,o.createVNode)(u,{"separator-icon":d.ArrowRight},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c,{to:{path:"/home/welcome"}},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("首页")])),_:1}),(0,o.createVNode)(c,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("权限管理")])),_:1}),(0,o.createVNode)(c,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("角色列表")])),_:1})])),_:1},8,["separator-icon"]),(0,o.createVNode)(x,null,{default:(0,o.withCtx)((()=>[(0,o.createVNode)(p,null,{default:(0,o.withCtx)((()=>[(0,o.createVNode)(m,null,{default:(0,o.withCtx)((()=>[(0,o.createVNode)(h,{type:"primary",size:"large",onClick:t[0]||(t[0]=e=>n.showAddDialog())},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("添加角色")])),_:1})])),_:1})])),_:1}),(0,o.createVNode)(w,{data:d.rolesList,border:"",stripe:"","row-key":"id"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(C,{type:"expand"},{default:(0,o.withCtx)((e=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(e.row.children,((t,r)=>((0,o.openBlock)(),(0,o.createBlock)(p,{class:(0,o.normalizeClass)([["vcenter","bdbottom",0===r?"bdtop":""],"role-expand"]),key:t.id},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(m,{span:5},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(g,{closable:"",type:"danger",onClose:r=>n.removeRightById(e.row,t.id,t.authName)},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(t.authName),1)])),_:2},1032,["onClose"]),(0,o.createVNode)(V,null,{default:(0,o.withCtx)((()=>[(0,o.createVNode)(f)])),_:1})])),_:2},1024),(0,o.createVNode)(m,{span:19},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(t.children,((t,r)=>((0,o.openBlock)(),(0,o.createBlock)(p,{class:(0,o.normalizeClass)(["vcenter",0===r?"":"bdtop"]),key:t.id},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(m,{span:6},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(g,{closable:"",type:"warning",onClose:r=>n.removeRightById(e.row,t.id,t.authName)},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(t.authName),1)])),_:2},1032,["onClose"]),(0,o.createVNode)(V,null,{default:(0,o.withCtx)((()=>[(0,o.createVNode)(f)])),_:1})])),_:2},1024),(0,o.createVNode)(m,{span:18},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(t.children,(t=>((0,o.openBlock)(),(0,o.createBlock)(g,{closable:"",type:"success",key:t.id,onClose:r=>n.removeRightById(e.row,t.id,t.authName)},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(t.authName),1)])),_:2},1032,["onClose"])))),128))])),_:2},1024)])),_:2},1032,["class"])))),128))])),_:2},1024)])),_:2},1032,["class"])))),128))])),_:1}),(0,o.createVNode)(C,{type:"index",label:"#"}),(0,o.createVNode)(C,{label:"角色名称",prop:"roleName"}),(0,o.createVNode)(C,{label:"角色描述",prop:"roleDesc"}),(0,o.createVNode)(C,{label:"操作",width:"234px"},{default:(0,o.withCtx)((e=>[(0,o.createVNode)(h,{type:"primary",icon:d.Edit,size:"small",style:{padding:"5px 6px"},onClick:t=>n.showEditDialog(e.row.id)},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("编辑")])),_:2},1032,["icon","onClick"]),(0,o.createVNode)(h,{type:"danger",icon:d.Delete,size:"small",style:{padding:"5px 6px"},onClick:t=>n.removeRoleById(e.row.id)},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("删除")])),_:2},1032,["icon","onClick"]),(0,o.createVNode)(h,{type:"warning",icon:d.Setting,size:"small",style:{padding:"5px 6px"},onClick:t=>n.showSetRightsDialog(e.row)},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("分配权限")])),_:2},1032,["icon","onClick"])])),_:1})])),_:1},8,["data"])])),_:1}),(0,o.createVNode)(v,{modelValue:d.addDialogVisible,"onUpdate:modelValue":t[4]||(t[4]=e=>d.addDialogVisible=e),title:"添加角色",width:"50%",onClose:n.addDialogClosed},{footer:(0,o.withCtx)((()=>[(0,o.createElementVNode)("span",a,[(0,o.createVNode)(h,{onClick:t[3]||(t[3]=e=>d.addDialogVisible=!1)},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("取消")])),_:1}),(0,o.createVNode)(h,{type:"primary",onClick:n.addRole},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)(" 确认 ")])),_:1},8,["onClick"])])])),default:(0,o.withCtx)((()=>[(0,o.createVNode)(y,{model:d.addRoleForm,"label-width":"80px",rules:d.addRoleRules,ref:"addFormRef"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(b,{label:"角色名称",prop:"roleName"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(N,{modelValue:d.addRoleForm.roleName,"onUpdate:modelValue":t[1]||(t[1]=e=>d.addRoleForm.roleName=e)},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(b,{label:"角色描述",prop:"roleDesc"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(N,{modelValue:d.addRoleForm.roleDesc,"onUpdate:modelValue":t[2]||(t[2]=e=>d.addRoleForm.roleDesc=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","onClose"]),(0,o.createVNode)(v,{modelValue:d.editDialogVisible,"onUpdate:modelValue":t[8]||(t[8]=e=>d.editDialogVisible=e),title:"修改角色信息",width:"50%",onClose:n.editDialogClosed},{footer:(0,o.withCtx)((()=>[(0,o.createElementVNode)("span",l,[(0,o.createVNode)(h,{onClick:t[7]||(t[7]=e=>d.editDialogVisible=!1)},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("取消")])),_:1}),(0,o.createVNode)(h,{type:"primary",onClick:n.editRole},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)(" 确认 ")])),_:1},8,["onClick"])])])),default:(0,o.withCtx)((()=>[(0,o.createVNode)(y,{model:d.editRoleForm,"label-width":"80px",rules:d.editRoleRules,ref:"editFormRef"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(b,{label:"角色名称"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(N,{modelValue:d.editRoleForm.roleName,"onUpdate:modelValue":t[5]||(t[5]=e=>d.editRoleForm.roleName=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(b,{label:"角色描述",prop:"roleDesc"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(N,{modelValue:d.editRoleForm.roleDesc,"onUpdate:modelValue":t[6]||(t[6]=e=>d.editRoleForm.roleDesc=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","onClose"]),(0,o.createVNode)(v,{modelValue:d.setRightsDialogVisible,"onUpdate:modelValue":t[10]||(t[10]=e=>d.setRightsDialogVisible=e),title:"分配权限",width:"50%",onClose:n.setRightsDialogClosed},{footer:(0,o.withCtx)((()=>[(0,o.createElementVNode)("span",i,[(0,o.createVNode)(h,{onClick:t[9]||(t[9]=e=>d.setRightsDialogVisible=!1)},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("取消")])),_:1}),(0,o.createVNode)(h,{type:"primary",onClick:n.allotRights},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("确认")])),_:1},8,["onClick"])])])),default:(0,o.withCtx)((()=>[(0,o.createVNode)(R,{data:d.rightsList,props:d.treeProps,"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":d.defKeys,ref:"treeRef"},null,8,["data","props","default-checked-keys"])])),_:1},8,["modelValue","onClose"])])}r(7658);var d=r(3010),n={data(){return{ArrowRight:d.ArrowRight,Edit:d.Edit,Delete:d.Delete,Setting:d.Setting,rolesList:[],addDialogVisible:!1,addRoleForm:{},addRoleRules:{roleName:[{required:!0,message:"必须输入角色名称",trigger:"blur"},{min:2,message:"角色名称至少需要两个汉字",trigger:"blur"}],roleDesc:[{required:!0,message:"必须输入角色描述",trigger:"blur"},{min:2,message:"角色描述至少需要两个汉字",trigger:"blur"}]},editDialogVisible:!1,editRoleRules:{roleDesc:[{required:!0,message:"必须输入角色没描述",trigger:"blur"},{min:2,message:"角色描述至少需要两个汉字",trigger:"blur"}]},editRoleForm:{},editRoleBackup:{},setRightsDialogVisible:!1,rightsList:[],treeProps:{label:"authName",children:"children"},defKeys:[],setRightsRoleId:""}},created(){this.getRolesList()},methods:{getRolesList(){this.$api.httpGet("roles",{showOuter:"error",error:["获取角色列表失败！"]}).then((e=>{this.rolesList=e.data}))},showAddDialog(){this.addDialogVisible=!0},addDialogClosed(){this.$refs.addFormRef.resetFields()},addRole(){this.$api.httpPost("roles",this.addRoleForm,{showOuter:"error",success:["角色添加成功！"],error:["角色添加失败！"]},201).then((()=>{this.addDialogVisible=!1,this.getRolesList()}))},removeRightById(e,t,r){this.$confirm(`此操作将永久删除该角色的【${r}】权限，是否继续？`,"权限删除",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$api.httpDelete(`roles/${e.id}/rights/${t}`,{showOuter:"error",error:["删除权限失败！"]}).then((t=>{e.children=t.data}))})).catch((()=>{this.$message({type:"info",message:"取消删除",duration:1200})}))},async showEditDialog(e){const t=await this.$api.httpGet("roles/"+e,{showOuter:"error",error:["获取角色信息失败！"]});this.editRoleForm=t.data,this.editRoleBackup={...t.data},this.editDialogVisible=!0},editDialogClosed(){this.$refs.editFormRef.resetFields()},async editRole(){if(this.editRoleForm.roleDesc===this.editRoleBackup.roleDesc)return this.$message({message:"角色信息未修改，更新取消",duration:1200});await this.$api.httpPut("roles/"+this.editRoleForm.roleId,this.editRoleForm,{success:["更新角色信息成功！"],error:["更新角色信息失败！"],showOuter:"error"});this.editDialogVisible=!1,this.getRolesList()},removeRoleById(e){this.$confirm("此操作将永久删除该角色，是否继续？","删除",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$api.httpDelete("roles/"+e,{showOuter:"error",success:["删除角色成功！"],error:["删除角色失败！"]}).then((()=>{this.getRolesList()}))})).catch((()=>{this.$message({type:"info",message:"取消删除",duration:1200})}))},async showSetRightsDialog(e){this.setRightsRoleId=e.id;const t=await this.$api.httpGet("rights/tree",{showOuter:"error",error:["获取权限数据失败！"]});this.rightsList=t.data,this.getLeafKeys(e,this.defKeys),this.setRightsDialogVisible=!0},getLeafKeys(e,t){if(!e.children)return t.push(e.id);e.children.forEach((e=>this.getLeafKeys(e,t)))},setRightsDialogClosed(){this.defKeys=[]},allotRights(){const e=[...this.$refs.treeRef.getCheckedKeys(),...this.$refs.treeRef.getHalfCheckedKeys()],t=e.join(",");this.$api.httpPost(`roles/${this.setRightsRoleId}/rights`,{rids:t},{showOuter:"error",success:["分配权限成功！"],error:["分配权限失败！"]}).then((e=>{this.getRolesList(),this.setRightsDialogVisible=!1}))}}},c=r(89);const u=(0,c.Z)(n,[["render",s],["__scopeId","data-v-326b8334"]]);var h=u},4689:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return m}});var o=r(311);const a={class:"mt-4"},l={class:"dialog-footer"},i={class:"dialog-footer"},s={class:"dialog-footer"};function d(e,t,r,d,n,c){const u=(0,o.resolveComponent)("el-breadcrumb-item"),h=(0,o.resolveComponent)("el-breadcrumb"),m=(0,o.resolveComponent)("el-button"),p=(0,o.resolveComponent)("el-input"),g=(0,o.resolveComponent)("el-col"),f=(0,o.resolveComponent)("el-row"),V=(0,o.resolveComponent)("el-table-column"),C=(0,o.resolveComponent)("el-switch"),w=(0,o.resolveComponent)("el-tooltip"),x=(0,o.resolveComponent)("el-table"),N=(0,o.resolveComponent)("el-pagination"),b=(0,o.resolveComponent)("el-card"),y=(0,o.resolveComponent)("el-form-item"),v=(0,o.resolveComponent)("el-form"),R=(0,o.resolveComponent)("el-dialog"),_=(0,o.resolveComponent)("el-option"),k=(0,o.resolveComponent)("el-select");return(0,o.openBlock)(),(0,o.createElementBlock)("div",null,[(0,o.createVNode)(h,{"separator-icon":n.ArrowRight},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(u,{to:{path:"/home/welcome"}},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("首页")])),_:1}),(0,o.createVNode)(u,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("用户管理")])),_:1}),(0,o.createVNode)(u,null,{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("用户列表")])),_:1})])),_:1},8,["separator-icon"]),(0,o.createVNode)(b,null,{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",a,[(0,o.createVNode)(f,{gutter:20},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(g,{span:8},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(p,{modelValue:n.queryInfo.query,"onUpdate:modelValue":t[0]||(t[0]=e=>n.queryInfo.query=e),placeholder:"请输入用户名",class:"input-with-select",clearable:"",onClear:c.getUserList},{append:(0,o.withCtx)((()=>[(0,o.createVNode)(m,{icon:n.Search,onClick:c.getUserList},null,8,["icon","onClick"])])),_:1},8,["modelValue","onClear"])])),_:1}),(0,o.createVNode)(g,{span:4},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(m,{type:"primary",onClick:t[1]||(t[1]=e=>n.addDialogVisible=!0)},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("添加用户")])),_:1})])),_:1})])),_:1})]),(0,o.createVNode)(x,{data:n.userList,border:"",stripe:""},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(V,{label:"#",type:"index",width:"35"}),(0,o.createVNode)(V,{label:"姓名",prop:"username",width:"100"}),(0,o.createVNode)(V,{label:"邮箱",prop:"email",width:"140"}),(0,o.createVNode)(V,{label:"电话",prop:"mobile",width:"120"}),(0,o.createVNode)(V,{label:"角色",prop:"role_name",width:"90"}),(0,o.createVNode)(V,{label:"状态",width:"65"},{default:(0,o.withCtx)((e=>[(0,o.createVNode)(C,{modelValue:e.row.mg_state,"onUpdate:modelValue":t=>e.row.mg_state=t,onChange:t=>c.userStateChanged(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),(0,o.createVNode)(V,{label:"操作","min-width":"160px"},{default:(0,o.withCtx)((e=>[(0,o.createVNode)(w,{content:"编辑",placement:"top",enterable:!1},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(m,{type:"primary",icon:n.Edit,size:"small",onClick:t=>c.showEditDialog(e.row.id)},null,8,["icon","onClick"])])),_:2},1024),(0,o.createVNode)(w,{content:"删除",placement:"top",enterable:!1},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(m,{type:"danger",icon:n.Delete,size:"small",onClick:t=>c.removeUserById(e.row.id)},null,8,["icon","onClick"])])),_:2},1024),(0,o.createVNode)(w,{content:"分配角色",placement:"top",enterable:!1},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(m,{type:"warning",icon:n.Setting,size:"small",onClick:t=>c.showSetRoleDialog(e.row)},null,8,["icon","onClick"])])),_:2},1024)])),_:1})])),_:1},8,["data"]),(0,o.createVNode)(N,{"current-page":n.queryInfo.pagenum,"onUpdate:currentPage":t[2]||(t[2]=e=>n.queryInfo.pagenum=e),"page-size":n.queryInfo.pagesize,"onUpdate:pageSize":t[3]||(t[3]=e=>n.queryInfo.pagesize=e),"page-sizes":[1,2,5,10],small:"",background:"",layout:"total, sizes, prev, pager, next, jumper",total:n.total,onSizeChange:c.handleSizeChange,onCurrentChange:c.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])),_:1}),(0,o.createVNode)(R,{modelValue:n.addDialogVisible,"onUpdate:modelValue":t[10]||(t[10]=e=>n.addDialogVisible=e),title:"添加用户",width:"50%",onClose:c.addDialogClosed},{footer:(0,o.withCtx)((()=>[(0,o.createElementVNode)("span",l,[(0,o.createVNode)(m,{onClick:t[9]||(t[9]=e=>n.addDialogVisible=!1)},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("取消")])),_:1}),(0,o.createVNode)(m,{type:"primary",onClick:c.addUser},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)(" 确认 ")])),_:1},8,["onClick"])])])),default:(0,o.withCtx)((()=>[(0,o.createVNode)(v,{model:n.addUserForm,"label-width":"120px",rules:n.addUserRules,ref:"addFormRef"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(y,{label:"用户名称",prop:"username"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(p,{modelValue:n.addUserForm.username,"onUpdate:modelValue":t[4]||(t[4]=e=>n.addUserForm.username=e)},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(y,{label:"用户密码",prop:"password"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(p,{"show-password":"",modelValue:n.addUserForm.password,"onUpdate:modelValue":t[5]||(t[5]=e=>n.addUserForm.password=e)},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(y,{label:"再次输入密码",prop:"checkPassword"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(p,{"show-password":"",modelValue:n.addUserForm.checkPassword,"onUpdate:modelValue":t[6]||(t[6]=e=>n.addUserForm.checkPassword=e)},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(y,{label:"邮箱",prop:"email"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(p,{modelValue:n.addUserForm.email,"onUpdate:modelValue":t[7]||(t[7]=e=>n.addUserForm.email=e)},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(y,{label:"电话号码",prop:"mobile"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(p,{modelValue:n.addUserForm.mobile,"onUpdate:modelValue":t[8]||(t[8]=e=>n.addUserForm.mobile=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","onClose"]),(0,o.createVNode)(R,{modelValue:n.editDialogVisible,"onUpdate:modelValue":t[15]||(t[15]=e=>n.editDialogVisible=e),title:"修改用户信息",width:"50%",onClose:c.editDialogClosed},{footer:(0,o.withCtx)((()=>[(0,o.createElementVNode)("span",i,[(0,o.createVNode)(m,{onClick:t[14]||(t[14]=e=>n.editDialogVisible=!1)},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("取消")])),_:1}),(0,o.createVNode)(m,{type:"primary",onClick:c.editUser},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)(" 确认 ")])),_:1},8,["onClick"])])])),default:(0,o.withCtx)((()=>[(0,o.createVNode)(v,{model:n.editUserForm,"label-width":"120px",rules:n.editUserRules,ref:"editFormRef"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(y,{label:"用户名称"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(p,{modelValue:n.editUserForm.username,"onUpdate:modelValue":t[11]||(t[11]=e=>n.editUserForm.username=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(y,{label:"邮箱",prop:"email"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(p,{modelValue:n.editUserForm.email,"onUpdate:modelValue":t[12]||(t[12]=e=>n.editUserForm.email=e)},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(y,{label:"电话号码",prop:"mobile"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(p,{modelValue:n.editUserForm.mobile,"onUpdate:modelValue":t[13]||(t[13]=e=>n.editUserForm.mobile=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","onClose"]),(0,o.createVNode)(R,{modelValue:n.setRoleDialogVisible,"onUpdate:modelValue":t[18]||(t[18]=e=>n.setRoleDialogVisible=e),title:"分配角色",width:"50%",onClose:c.setRoleDialogClosed},{footer:(0,o.withCtx)((()=>[(0,o.createElementVNode)("span",s,[(0,o.createVNode)(m,{onClick:t[17]||(t[17]=e=>n.setRoleDialogVisible=!1)},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("取消")])),_:1}),(0,o.createVNode)(m,{type:"primary",onClick:c.setRole},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)(" 确认 ")])),_:1},8,["onClick"])])])),default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",null,[(0,o.createElementVNode)("p",null,"当前用户："+(0,o.toDisplayString)(n.userInfo.username),1),(0,o.createElementVNode)("p",null,"用户角色："+(0,o.toDisplayString)(n.userInfo.role_name),1),(0,o.createElementVNode)("p",null,[(0,o.createTextVNode)("分配新角色： "),(0,o.createVNode)(k,{modelValue:n.selectedRoleId,"onUpdate:modelValue":t[16]||(t[16]=e=>n.selectedRoleId=e),placeholder:"选择角色"},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(n.rolesList,(e=>((0,o.openBlock)(),(0,o.createBlock)(_,{key:e.id,label:e.roleName,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])])])),_:1},8,["modelValue","onClose"])])}r(1703);var n=r(3010),c={data(){const e=(e,t,r)=>{const o=/^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/;o.test(t)||""==t?r():r(new Error("请输入正确的电话号码"))},t=(e,t,r)=>{var o=/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/,a=/^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/;!o.test(t)&&""!=t||!a.test(t)&&""!=t?r(new Error("请输入有效邮箱格式！")):r()},r=(e,t,r)=>{if(""!==t&&""!==this.addUserForm.checkPassword)return this.$refs.addFormRef.validateField("checkPassword",(()=>null));r()},o=(e,t,r)=>{if(""!==t&&t!==this.addUserForm.password)return r(new Error("两次输入的密码不一致"));r()};return{ArrowRight:n.ArrowRight,Search:n.Search,Edit:n.Edit,Delete:n.Delete,Setting:n.Setting,queryInfo:{query:"",pagenum:1,pagesize:2},total:0,userList:[],addDialogVisible:!1,addUserForm:{username:"bcd123456",password:"bcd123456",checkPassword:"bcd123456",email:"bcd@123456.com",mobile:"13612345678"},addUserRules:{username:[{required:!0,message:"请输入登录名称",trigger:"blur"},{min:3,max:10,message:"用户名长度 3 到 10 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入登录密码",trigger:"blur"},{min:6,max:20,message:"密码长度 6 到 20 个字符",trigger:"blur"},{validator:r,trigger:"blur"}],checkPassword:[{required:!0,message:"请再次输入登录密码",trigger:"blur"},{min:6,max:20,message:"密码长度 6 到 20 个字符",trigger:"blur"},{validator:o,trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{validator:t,trigger:"blur"}],mobile:[{required:!0,message:"请输入电话号码",trigger:"blur"},{validator:e,trigger:"blur"}]},editDialogVisible:!1,editUserForm:{},editUserRules:{email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{validator:t,trigger:"blur"}],mobile:[{required:!0,message:"请输入电话号码",trigger:"blur"},{validator:e,trigger:"blur"}]},editUserFormBackup:{},userInfo:{},setRoleDialogVisible:!1,rolesList:[],setRoleTreeProps:{label:"roleName",children:"children"},selectedRoleId:""}},created(){this.getUserList()},methods:{async getUserList(){const{data:e}=await this.$http.get("users",{params:this.queryInfo});if(200!==e.meta.status)return this.$message.error({message:"获取用户名列表失败",duration:1200});this.total=e.data.total,this.userList=e.data.users},handleSizeChange(e){this.queryInfo.pagesize=e,this.getUserList()},handleCurrentChange(e){this.queryInfo.pagenum=e,this.getUserList()},async userStateChanged(e){const{data:t}=await this.$http.put(`users/${e.id}/state/${e.mg_state}`);200!==t.meta.status&&(this.$message.error({message:"更新用户状态失败！",duration:1200}),e.mg_state=!e.mg_state),this.$message.success({message:"更新用户状态成功！",duration:1200})},addDialogClosed(){this.$refs.addFormRef.resetFields()},addUser(){this.$refs.addFormRef.validate((async e=>{if(!e)return;const{data:t}=await this.$http.post("users",this.addUserForm);if(201!==t.meta.status)return this.$message.error({message:"添加用户失败！"+t.meta.msg,duration:1200});this.$message.success({message:"添加用户成功！",duration:1200}),this.addDialogVisible=!1,this.getUserList()}))},showEditDialog(e){this.$api.httpGet(`users/${e}`,{error:["查询用户信息失败！"],showOuter:"error"}).then((e=>{this.editUserForm=e.data,this.editUserFormBackup={...e.data},this.editDialogVisible=!0}))},editDialogClosed(){this.$refs.editFormRef.resetFields()},editUser(){this.$refs.editFormRef.validate((e=>{if(e)return this.editUserForm.email===this.editUserFormBackup.email&&this.editUserForm.mobile===this.editUserFormBackup.mobile?this.$message({message:"用户信息未改动",duration:1200}):void this.$api.httpPut("users/"+this.editUserForm.id,this.editUserForm,{error:["更新用户信息失败！"],showOuter:"error"}).then((e=>{this.editDialogVisible=!1,this.getUserList(),this.$message.success({message:"更新用户信息成功",duration:1200})}))}))},removeUserById(e){this.$confirm("此操作将永久删除该用户，是否继续？","删除",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$api.httpDelete("users/"+e,{showOuter:"error",success:["删除用户成功！"],error:["删除用户失败！"]}).then((()=>{this.getUserList()}))})).catch((()=>{this.$message({type:"info",message:"取消删除",duration:1200})}))},async showSetRoleDialog(e){this.userInfo=e;const{data:t}=await this.$api.httpGet("roles",{showOuter:"error",error:["角色列表获取失败！"]});this.rolesList=t,this.setRoleDialogVisible=!0},setRole(){if(!this.selectedRoleId)return this.$message({message:"您没有为用户指定角色",duration:1200});this.$api.httpPut(`users/${this.userInfo.id}/role`,{rid:this.selectedRoleId},{error:["分配用户角色失败"]}).then((()=>{this.setRoleDialogVisible=!1,this.getUserList()}))},setRoleDialogClosed(){this.selectedRoleId="",this.userInfo={}}}},u=r(89);const h=(0,u.Z)(c,[["render",d]]);var m=h}}]);
//# sourceMappingURL=users_rights_roles.30644c3e.js.map